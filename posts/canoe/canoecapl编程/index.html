<!doctype html><html><head><title>CANoe CAPL编程</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/css/bootstrap.min.css><link rel=stylesheet href=/css/layouts/main.css><link rel=stylesheet href=/css/navigators/navbar.css><link rel=stylesheet href=/css/plyr.css><link rel=stylesheet href=/css/flag-icon.min.css><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Muli:wght@300;400;500;600"><link rel=stylesheet href=/fontawesome/css/all.min.css><link rel=icon type=image/png href=/images/site/favicon_huc1eb155f918f3b6b0f4ee18df88cff65_18120_42x0_resize_box_3.png><meta property="og:title" content="CANoe CAPL编程"><meta property="og:description" content="Shortcodes sample"><meta property="og:type" content="article"><meta property="og:url" content="https://GaoSHF.github.io/posts/canoe/canoecapl%E7%BC%96%E7%A8%8B/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-06-08T08:06:25+08:00"><meta property="article:modified_time" content="2022-06-21T14:54:23+00:00"><meta name=description content="Shortcodes sample"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/atom-one-dark.min.css><link rel=stylesheet href=/css/layouts/single.css><link rel=stylesheet href=/css/navigators/sidebar.css><link rel=stylesheet href=/css/style.css></head><body data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button onclick=toggleSidebar()>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/><img src=/images/site/main-logo_hu846ad9ac893a6e5b96062b389f72ccce_54727_42x0_resize_box_3.png alt=Logo>
Gao's Blog</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button onclick=toggleTOC()>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"></ul></div></div><img src=/images/site/main-logo_hu846ad9ac893a6e5b96062b389f72ccce_54727_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_huc1eb155f918f3b6b0f4ee18df88cff65_18120_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/search><input type=text name=keyword placeholder=搜索 data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/posts data-filter=all>博客</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/posts/category/>Category</a><ul><li><a href=/posts/category/%E6%B5%8B%E8%AF%95/%E6%B5%8B%E8%AF%95/ title=测试1>测试1</a></li><li><a href=/posts/category/%E6%B5%8B%E8%AF%952/%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3/ title=测试2>测试2</a></li><li><a href=/posts/category/%E6%B5%8B%E8%AF%953/%E6%B5%8B%E8%AF%95%E6%96%87%E6%A1%A3/ title=测试3>测试3</a></li></ul></li><li><a href=/posts/markdown-sample/ title="Markdown Sample">Markdown Sample</a></li><li><a href=/posts/shortcodes/ title="Shortcodes Sample">Shortcodes Sample</a></li><li><i class="fas fa-plus-circle"></i><a href=/posts/%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/>安装与配置文件</a><ul><li><a href=/posts/%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/hugo%E5%9C%A8github%E9%85%8D%E7%BD%AE%E7%BD%91%E9%A1%B5/hugo%E5%9C%A8github%E4%B8%8A%E6%90%AD%E5%BB%BA%E9%9D%99%E6%80%81%E7%BD%91%E9%A1%B5/ title=hugo在github配置静态网页>hugo在github配置静态网页</a></li><li><a href=/posts/%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6%E5%A4%B9/yige%E6%96%87%E6%A1%A3/ title=一个文档>一个文档</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/posts/canoe/>CANoe</a><ul class=active><li><a class=active href=/posts/canoe/canoecapl%E7%BC%96%E7%A8%8B/ title="CANoe CAPL编程">CANoe CAPL编程</a></li><li><a href=/posts/canoe/capl%E7%AC%94%E8%AE%B0/ title="Hero 测试">Hero 测试</a></li></ul></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(https://GaoSHF.github.io/posts/canoe/canoecapl%E7%BC%96%E7%A8%8B/hero.svg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/john_hu7f9991f5b5d471ecdfc6cff3db1a9fe6_6397_120x120_fit_box_3.png alt="Author Image"><h5 class=author-name></h5><p>Monday, June 8, 2020</p></div><div class=title><h1>CANoe CAPL编程</h1></div><div class=taxonomy-terms><ul></ul></div><div class=post-content id=post-content><h2 id=canoe-capl编程>CANoe CAPL编程</h2><h3 id=1-capl概述>1. CAPL概述</h3><p>与Vspy的"C Code Interface"一样；在CANoe的使用中，一样提供了我们进行<strong>二次编程开发</strong>的工具——”<strong>CAPL Browser</strong>”。通过CAPL的编程，我们可以在节点上完成更为复杂的功能需求。操作如下：在CANoe工程的”<strong>Simulation Setup</strong>”界面下的左侧的<strong>网络节点</strong>中，点击<strong>铅笔形状的图标</strong>，进入CAPL编辑界面（若当前节点还没有创建对应的CAPL程序，则此时会先提示输入CAPL程序名，并<strong>保存为.can后缀的文件</strong>）</p><p><img src=https://cdn.jsdelivr.net/gh/GaoSHF/7011/blogs/24b04cae1ab749738c052210b271225b.png alt></p><h4 id=11-capl语言特性>1.1 CAPL语言特性</h4><ul><li>CAPL（Communication Access Programming Laguage）语言是<strong>类C语言</strong>，语法其实与C语言很相似，但同时又包含了一些C++的特性，如<strong>this指针、事件</strong>等；</li><li>应用于Vector CAN工具节点的编程，是基于事件建模的语言；</li><li>可以使用<strong>write()函数</strong>进行调试，用于将调试信息输出到CANoe的write窗口上；</li><li>通过<strong>output()函数进行指定报文的发送</strong>；</li><li>通常是通过环境变量事件与CANoe面板进行关联，实现交互；</li><li><strong>提供调用dll文件的方法</strong>（操作见"关于CAPL中对dll的调用操作"一文）；这样保证了对由其他语言封装好的程序模块的调用；</li></ul><h4 id=12-capl的程序结构>1.2 CAPL的程序结构</h4><p>如下，一个完整的CAPL程序的结构包含了<strong>头文件、全局变量、事件函数、自定义函数</strong>；当然不是每个因素都要有，视具体程序功能确定。</p><p><img src=https://cdn.jsdelivr.net/gh/GaoSHF/7011/blogs/ae70c67136834e05ac2a1133b3b1fd3f.png alt></p><h4 id=13-capl的数据类型>1.3 CAPL的数据类型</h4><p><img src=https://cdn.jsdelivr.net/gh/GaoSHF/7011/blogs/030a91e452b14b22a88c04204578f0d5.jpg alt></p><h4 id=14-capl事件类型概述>1.4 CAPL事件类型概述</h4><p>CAPL是基于事件建模的语言，从1.2小节对CAPL的程序结构的介绍也可以看出，关于CAPL的运用主要就是在于熟悉其事件的使用；其常用的事件如下：</p><p><img src=https://cdn.jsdelivr.net/gh/GaoSHF/7011/blogs/%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20210323161403.png alt></p><p>事件过程语法结构中 蓝色字体表示该程序的关键字，深红色字体表示用户自定义的名称。</p><p>{&mldr;}内是CAPL程序体，用户可根据需要使用CAPL语言编写。</p><h3 id=2-capl事件类型>2. CAPL事件类型</h3><h4 id=21-系统事件>2.1 系统事件</h4><p>在CAPL的系统事件中，有<strong>preStart、start、preStop、stopMeasurement</strong>这4种。我们可以根据需要在相应的系统事件函数接口中定义想要进行的操作；当<strong>工程运行时，下述系统事件的发生顺序依次是</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>preStart<span style=color:#f92672>--&gt;</span>start<span style=color:#f92672>--&gt;</span>preStop<span style=color:#f92672>--&gt;</span>stopMeasurement
</span></span></code></pre></div><p>关于系统事件的<strong>定义格式如下</strong>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>on preStart   	  	    <span style=color:#75715e>/*系统事件，初始化时执行*/</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span> 	resetCan();      	<span style=color:#75715e>/*CAPL接口函数，用于复位CAN控制器*/</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>on start        	    <span style=color:#75715e>/*系统事件，工程开始时执行*/</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span> 	write(<span style=color:#960050;background-color:#1e0010>“</span>Just A Try<span style=color:#960050;background-color:#1e0010>”</span>);   <span style=color:#75715e>/*write()函数将字符串信息在”write”窗口输出*/</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>on preStop    <span style=color:#75715e>/*系统事件，工程预备停止时执行;发生stopMeasurement事件前面*/</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  	write(<span style=color:#e6db74>&#34;The Project Will Stop!”);</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>on stopMeasurement  		<span style=color:#75715e>/*系统事件，工程停止时执行*/</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  	write(<span style=color:#e6db74>&#34;The End!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=22-can控制器事件>2.2 CAN控制器事件</h4><p><strong>当硬件对CAN控制器检测到相应动作发生时执行</strong>；以BusOff事件为例，格式如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>on busOff       <span style=color:#75715e>/*CAN控制器事件：硬件检测到BusOff时执行*/</span>
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>	  	write(<span style=color:#e6db74>&#34;BusOff Error!&#34;</span>);
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div><h4 id=23-can消息事件>2.3 CAN消息事件</h4><p>通过“on message"定义消息事件，该事件会在指定的报文消息被接收时被调用。关于消息事件的定义格式示例如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>on message <span style=color:#ae81ff>123</span>         		<span style=color:#75715e>/*接收到123（10进制）这个ID的报文时执行*/</span>
</span></span><span style=display:flex><span>on message <span style=color:#ae81ff>0x441</span>       		<span style=color:#75715e>/*接收到0x441（16进制）这个ID的报文时执行*/</span>
</span></span><span style=display:flex><span>on message BCM 	       		<span style=color:#75715e>/*接收到BCM（工程dbc文件中的报文名）这个报文时执行*/</span>
</span></span><span style=display:flex><span>on message<span style=color:#f92672>*</span>	      			<span style=color:#75715e>/*接收到任意报文时都执行（注意*与message之间没有空格）*/</span>
</span></span><span style=display:flex><span>on message <span style=color:#ae81ff>0x300</span><span style=color:#f92672>-</span><span style=color:#ae81ff>0x444</span>	 	<span style=color:#75715e>/*接收到这个范围内的ID报文时执行*/</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  	write(<span style=color:#960050;background-color:#1e0010>“</span>Received <span style=color:#f92672>%</span>x<span style=color:#960050;background-color:#1e0010>”</span>,this.id);	 <span style=color:#75715e>/*打印接收到的报文id*/</span>
</span></span><span style=display:flex><span>  	write(<span style=color:#960050;background-color:#1e0010>“</span>Received Message <span style=color:#f92672>%</span>d in total<span style=color:#f92672>!</span><span style=color:#960050;background-color:#1e0010>”</span>,count)<span style=color:#960050;background-color:#1e0010>；</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>​ 以上是关于消息事件的定义格式，关于<strong>消息的索引及发送操作</strong>我们通过下例介绍：
​ 假设VoiceStatus是我们工程dbc文件中定义的一个报文，该报文包括了VoiceType和VoiceOperation这两个信号；其中，VoiceType这个变量占据第1个字节；VoiceOperation占据第2、3个字节；则<strong>关于消息的索引，通过报文的信号(msg.VoiceType这样)去操作如下</strong>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>TxMsg_VoiceStatus</span>(<span style=color:#66d9ef>void</span>) 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    message VoiceStatus msg;         <span style=color:#75715e>/*将工程中dbc中定义的VoiceStatus这条报文取名为msg*/</span>
</span></span><span style=display:flex><span>    msg.VoiceType <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>@</span>VoiceType;      <span style=color:#75715e>/*对应赋值给到报文的信号，通过报文别名&#34;msg.&#34;调出*/</span>
</span></span><span style=display:flex><span>    msg.VoiceOperation <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>@</span>VoiceOperation;
</span></span><span style=display:flex><span>    output(msg);                     <span style=color:#75715e>/*通过output指令发送该报文*/</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>也可以直接<strong>通过后接数据类型(msg.byte(0)这样)去操作，此时操作如下</strong>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>TxMsg_VoiceStatus</span>(<span style=color:#66d9ef>void</span>) 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    message VoiceStatus msg;         <span style=color:#75715e>/*将工程中dbc中定义的VoiceStatus这条报文取名为msg*/</span>
</span></span><span style=display:flex><span>    msg.byte(<span style=color:#ae81ff>0</span>) <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>@</span>VoiceType;        <span style=color:#75715e>/*报文第1个数据字节*/</span>
</span></span><span style=display:flex><span>    msg.word(<span style=color:#ae81ff>1</span>) <span style=color:#f92672>=</span> <span style=color:#960050;background-color:#1e0010>@</span>VoiceOperation; ; <span style=color:#75715e>/*报文从第1个字节开始的一个字（2个字节）*/</span>
</span></span><span style=display:flex><span>    output(msg);                     <span style=color:#75715e>/*通过output指令发送该报文*/</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=24-键盘事件>2.4 键盘事件</h4><p>通过”<strong>on key</strong>”定义键盘事件,该事件会在我们<strong>按下指定按键时执行</strong>;关于键盘事件的<strong>定义格式示例如下</strong>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>on key <span style=color:#960050;background-color:#1e0010>‘</span>a<span style=color:#960050;background-color:#1e0010>’</span>      	<span style=color:#75715e>/*在小写输入法下，按下键盘的’A’键时执行*/</span>
</span></span><span style=display:flex><span>on key <span style=color:#960050;background-color:#1e0010>‘</span>A<span style=color:#960050;background-color:#1e0010>’</span>      	<span style=color:#75715e>/*在大写输入法下，按下键盘的’A’键时执行*/</span>
</span></span><span style=display:flex><span>on key <span style=color:#960050;background-color:#1e0010>‘</span> <span style=color:#960050;background-color:#1e0010>’</span>      	<span style=color:#75715e>/*按下键盘的空格键时执行，注意单引号中间是有空格的*/</span>
</span></span><span style=display:flex><span>on key <span style=color:#ae81ff>0x20</span>     	<span style=color:#75715e>/*按下键盘的空格键时执行*/</span>
</span></span><span style=display:flex><span>on key F2      	    <span style=color:#75715e>/*按下键盘的’F2’键时执行*/</span>
</span></span><span style=display:flex><span>on key Ctrl<span style=color:#f92672>-</span>F3      	<span style=color:#75715e>/*同时按下键盘的’Ctrl’键和’F3’键时执行*/</span>
</span></span><span style=display:flex><span>on key<span style=color:#f92672>*</span>      		<span style=color:#75715e>/*按下键盘的任意键时都会执行（注意*与key之间没有空格） */</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  	write(<span style=color:#960050;background-color:#1e0010>“</span>The Key Is Press<span style=color:#960050;background-color:#1e0010>”</span>)<span style=color:#960050;background-color:#1e0010>；</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=25-时间事件>2.5 时间事件</h4><p>通过”<strong>on timer</strong>”定义时间事件；该事件会<strong>在设定的时间到达时执行</strong>。关于时间事件的<strong>定义格式及使用示例如下</strong>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>variables
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  msTimer Timer1;    		<span style=color:#75715e>/*在variables中声明一个以ms为单位的定时器变量Timer1*/</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>on start
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  setTimer(Timer1,<span style=color:#ae81ff>100</span>);     <span style=color:#75715e>/*将Timer1的定时时间设定为100ms，并启动它*/</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>on timer Timer1  	 		<span style=color:#75715e>/*定义的Timer1时间事件，每100ms执行一次*/</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  setTimer(Timer1,<span style=color:#ae81ff>100</span>);     <span style=color:#75715e>/*启动下一个周期循环*/</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>on key <span style=color:#960050;background-color:#1e0010>‘</span>a<span style=color:#960050;background-color:#1e0010>‘</span>		 			<span style=color:#75715e>/*键盘事件，按下键盘’A’键时执行*/</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  cancelTimer(Timer1);	 	<span style=color:#75715e>/*停止Timer1这个100ms执行一次的定时器*/</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=26-错误帧事件>2.6 错误帧事件</h4><p>通过”<strong>on errorFrame</strong> ”定义错误帧事件；该事件会<strong>在硬件检测到错误帧时执行</strong>。关于错误帧事件的<strong>定义格式示例如下</strong>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>on errorFrame       <span style=color:#75715e>/*错误帧事件:硬件检测到错误帧时执行*/</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  write(<span style=color:#e6db74>&#34;The error has occur&#34;</span>); 
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=27-环境变量事件>2.7 环境变量事件</h4><p>通过”<strong>on envVar</strong>”定义环境变量事件；该事件会<strong>在指定的环境变量值有新的输入时执行</strong>（环境变量常常用于关联上一个面板控件，当我们<strong>对控件进行操作时，对应改变关联上的环境变量值；而此时我们在CAPL中关于该环境变量的事件就会被调用</strong>；以此完成交互操作）。关于环境变量事件的<strong>定义格式示例如下</strong>：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>on envVar BCM_HightBeamAlarm    <span style=color:#75715e>/*环境变量事件:指定的环境变量值有输入时执行*/</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	  byte num<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>	  num <span style=color:#f92672>=</span> getValue(this);     <span style=color:#75715e>/*可以使用getValue(环境变量名/this关键字)获取指定的环境变量的值*/</span>
</span></span><span style=display:flex><span>	  <span style=color:#66d9ef>if</span>(num <span style=color:#f92672>==</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>	  {
</span></span><span style=display:flex><span>	    write(<span style=color:#e6db74>&#34;The envVar is %d&#34;</span>,<span style=color:#960050;background-color:#1e0010>@</span>BCM_HightBeamAlarm);  
</span></span><span style=display:flex><span>	  }
</span></span><span style=display:flex><span>	  <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>	  {
</span></span><span style=display:flex><span>	    putValue(this,<span style=color:#ae81ff>1</span>);<span style=color:#75715e>/*使用putValue(环境变量名/this关键字,设定的值)改变指定的环境变量的值；直接赋值的话，格式是@BCM_HightBeamAlarm = 1; */</span>
</span></span><span style=display:flex><span>	    write(<span style=color:#e6db74>&#34;Change envVar to %d&#34;</span>,<span style=color:#960050;background-color:#1e0010>@</span>BCM_HightBeamAlarm);
</span></span><span style=display:flex><span>	  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>关于在CAPL中对环境变量的操作中，<strong>getValue()与putValue()是常用的接口函数</strong>。其函数格式如下，具体介绍及示例也可以通过神键"F1"召唤帮助文档，在"CAPL"相关章节中进行学习。</p><p><img src=https://cdn.jsdelivr.net/gh/GaoSHF/7011/blogs/cd6b9310a0b043dc8ad454f6202e7199.png alt></p><p><img src=https://cdn.jsdelivr.net/gh/GaoSHF/7011/blogs/5d23097740ac4289b9320257902bcd29.png alt></p><p>Ps:关于<strong>环境变量的定义是在dbc文件中完成的；CANoe工程导入该dbc文件即可使用其定义的环境变量了</strong>。环境变量的创建如下：</p><p><img src=https://cdn.jsdelivr.net/gh/GaoSHF/7011/blogs/66b827e5309b4724baf3e79eade62556.jpg alt></p><h4 id=28-系统变量事件>2.8 系统变量事件</h4><p>​ 通过”<strong>on sysvar</strong>”定义系统变量事件；该事件会<strong>在指定的系统变量值有新的输入时执行</strong>，其格式及使用方法与前一小节的环境变量基本一致；差别只在于环境变量是在dbc文件中定义的；而<strong>系统变量的定义如下</strong>：
​ 点击工具栏的”<strong>Environment”下的”System Variables</strong>”；此时界面如下，右键空白处，选择”<strong>New</strong>”进行新建；在弹出的窗口对新建的系统变量进行参数设置。</p><p><img src=https://cdn.jsdelivr.net/gh/GaoSHF/7011/blogs/d082de1b46d746d3a339172142a556bb.jpg alt></p><p>关于系统变量事件的定义格式如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>on sysvar SysVar1	 <span style=color:#75715e>/*系统变量事件:指定的系统变量值有新的输入时执行*/</span>
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>	  	write(<span style=color:#e6db74>&#34;The SysVar1 is %d&#34;</span>,<span style=color:#960050;background-color:#1e0010>@</span>SysVar1);
</span></span><span style=display:flex><span>	}
</span></span></code></pre></div></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/posts/%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/%E6%B5%8B%E8%AF%95%E6%96%87%E4%BB%B6%E5%A4%B9/yige%E6%96%87%E6%A1%A3/ title=一个文档 class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i> 上一篇</div><div class=next-prev-text>一个文档</div></a></div><div class="col-md-6 next-article"><a href=/posts/canoe/capl%E7%AC%94%E8%AE%B0/ title="hero 测试" class="btn btn-outline-info"><div>下一篇 <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>hero 测试</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">目录</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#canoe-capl编程>CANoe CAPL编程</a><ul><li><a href=#1-capl概述>1. CAPL概述</a><ul><li><a href=#11-capl语言特性>1.1 CAPL语言特性</a></li><li><a href=#12-capl的程序结构>1.2 CAPL的程序结构</a></li><li><a href=#13-capl的数据类型>1.3 CAPL的数据类型</a></li><li><a href=#14-capl事件类型概述>1.4 CAPL事件类型概述</a></li></ul></li><li><a href=#2-capl事件类型>2. CAPL事件类型</a><ul><li><a href=#21-系统事件>2.1 系统事件</a></li><li><a href=#22-can控制器事件>2.2 CAN控制器事件</a></li><li><a href=#23-can消息事件>2.3 CAN消息事件</a></li><li><a href=#24-键盘事件>2.4 键盘事件</a></li><li><a href=#25-时间事件>2.5 时间事件</a></li><li><a href=#26-错误帧事件>2.6 错误帧事件</a></li><li><a href=#27-环境变量事件>2.7 环境变量事件</a></li><li><a href=#28-系统变量事件>2.8 系统变量事件</a></li></ul></li></ul></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>导航</h5><ul><li class=nav-item><a class=smooth-scroll href=https://GaoSHF.github.io#about>简介</a></li><li class=nav-item><a class=smooth-scroll href=https://GaoSHF.github.io#skills>技能</a></li><li class=nav-item><a class=smooth-scroll href=https://GaoSHF.github.io#accomplishments>成果</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>联系方式:</h5><ul><li><a href=mailto:gaoshf@foxmail.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>gaoshf@foxmail.com</span></a></li><li><a href=https://github.com/GaoSHF target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>GaoSHF</span></a></li><li><span><i class="fas fa-phone-alt"></i></span> <span>+0123456789</span></li></ul></div></div></div><hr><div class=container><p id=disclaimer><strong>免责声明:</strong> This theme is under MIT license. So, you can use it for non-commercial, commercial, or private uses. You can modify or distribute the theme without requiring any permission from the theme author. However, the theme author does not provide any warranty or takes any liability for any issue with the theme.</p></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hossainemruz/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2022 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script type=text/javascript src=/js/jquery-3.4.1.min.js></script>
<script type=text/javascript src=/js/popper.min.js></script>
<script type=text/javascript src=/js/bootstrap.min.js></script>
<script type=text/javascript src=/js/navbar.js></script>
<script type=text/javascript src=/js/plyr.js></script>
<script type=text/javascript src=/js/main.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js></script>
<script src=/js/single.js></script>
<script>hljs.initHighlightingOnLoad()</script><script src=/js/mermaid-8.14.0.min.js></script>
<script>mermaid.initialize({startOnLoad:!0})</script></body></html>